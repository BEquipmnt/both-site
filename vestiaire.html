<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Le Vestiaire ‚Äî BOTH EQUIPMNT</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Work+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{ box-sizing:border-box; margin:0; padding:0; }
:root{
  --black:#0a0a0a; --white:#fafaf8; --off:#f0efeb;
  --grey-100:#e8e8e6; --grey-200:#1a1a1a; --grey-400:#6a6a6a; --grey-600:#9a9a9a;
  --red:#ffd700; --red-dark:#e6c200; --red-bg:#fdf0ef;
  --amber:#c49000; --blue:#3b82f6; --green:#16a34a;
  --display:'Oswald',sans-serif; --body:'Work Sans',sans-serif;
  --ease:.42s cubic-bezier(.4,0,.2,1);
}
html{ scroll-behavior:smooth; -webkit-font-smoothing:antialiased; }
body{ font-family:var(--body); background:var(--white); color:var(--black); font-weight:400; line-height:1.65; overflow-x:hidden; }
a{ text-decoration:none; color:inherit; cursor:pointer; }
img{ max-width:100%; display:block; }

/* ===== LOGIN ===== */
#login-screen{
  min-height:100vh; display:flex; align-items:center; justify-content:center;
  padding:2rem 1.2rem;
}
.login-box{ width:100%; max-width:400px; text-align:center; }
.login-box-logo img{ height:42px; margin:0 auto 2.5rem; }
.login-box h2{
  font-family:var(--display); font-size:1.8rem; font-weight:700;
  letter-spacing:.06em; margin-bottom:.5rem; text-transform:uppercase;
}
.login-box p{ font-size:.85rem; color:var(--grey-400); margin-bottom:2rem; line-height:1.8; }
.login-input{
  width:100%; padding:.9rem 1.1rem; border:2px solid #ddd; background:transparent;
  font-size:16px; outline:none; transition:border-color var(--ease); margin-bottom:.9rem;
}
.login-input:focus{ border-color:var(--black); }
.login-error{ font-size:.75rem; color:#c00; min-height:1rem; margin-bottom:.7rem; }
.btn-login{
  width:100%; padding:.9rem; background:var(--black); color:var(--white); border:none;
  font-size:.72rem; letter-spacing:.24em; text-transform:uppercase; font-weight:600;
  cursor:pointer; transition:background var(--ease);
}
.btn-login:hover{ background:#2a2a2a; }
.btn-login:disabled{ background:#ccc; color:#888; }
.login-back{
  display:inline-block; margin-top:2rem; font-size:.75rem; color:var(--grey-400);
  background:none; border:none; cursor:pointer; transition:color var(--ease);
}
.login-back:hover{ color:var(--black); }

/* ===== NAV VESTIAIRE ===== */
.v-nav{
  position:sticky; top:0; background:rgba(250,250,248,.96); backdrop-filter:blur(16px);
  border-bottom:1px solid #e0e0e0; padding:.8rem 1.2rem;
  display:flex; align-items:center; justify-content:space-between; z-index:10;
}
.v-nav-left{ display:flex; align-items:center; gap:.8rem; }
.v-nav-logo img{ height:40px; }
.v-nav-club-wrapper{
  display:flex; align-items:center; gap:.6rem;
  border-left:1px solid #e0e0e0; padding-left:.8rem;
}
.v-club-logo{ height:35px; max-width:70px; object-fit:contain; }
.v-nav-club{
  font-size:.65rem; letter-spacing:.15em; text-transform:uppercase;
  color:var(--grey-400); font-weight:600;
}
.v-nav-right{ display:flex; gap:.5rem; align-items:center; flex-wrap:wrap; }
.v-tab{
  font-size:.55rem; letter-spacing:.12em; text-transform:uppercase; font-weight:600;
  color:var(--grey-600); background:none; border:none; padding:.3rem 0;
  border-bottom:2px solid transparent; transition:all var(--ease); cursor:pointer;
}
.v-tab:hover{ color:var(--black); }
.v-tab.active{ color:var(--black); border-bottom-color:var(--red); }
.v-btn-cart{
  position:relative; padding:.35rem .7rem; border:2px solid var(--black); background:transparent;
  font-size:.55rem; letter-spacing:.15em; text-transform:uppercase; font-weight:600;
  color:var(--black); transition:all var(--ease); cursor:pointer;
}
.v-btn-cart:hover{ background:var(--black); color:var(--white); }
.cart-badge{
  position:absolute; top:-8px; right:-8px;
  background:var(--red); color:var(--black); font-size:.55rem; font-weight:700;
  width:18px; height:18px; border-radius:50%; display:none;
  align-items:center; justify-content:center; border:2px solid var(--white);
}
.cart-badge.show{ display:flex; }
.v-btn-quit{
  padding:.3rem .6rem; border:2px solid #ddd; background:transparent;
  font-size:.55rem; letter-spacing:.12em; text-transform:uppercase;
  color:var(--grey-600); font-weight:600; transition:all var(--ease); cursor:pointer;
}
.v-btn-quit:hover{ border-color:var(--black); color:var(--black); }

/* ===== SECTIONS ===== */
#portal{ display:none; }
#portal.active{ display:block; }
.v-section{ display:none; padding:1.5rem 1.2rem; min-height:calc(100vh - 58px); }
.v-section.active{ display:block; }
.v-section-inner{ max-width:1200px; margin:0 auto; }

.cat-header{
  display:flex; justify-content:space-between; align-items:flex-start;
  margin-bottom:2rem; flex-wrap:wrap; gap:.8rem; flex-direction:column;
}
.cat-header h2{
  font-family:var(--display); font-size:1.8rem; font-weight:700;
  letter-spacing:.04em; text-transform:uppercase;
}
.cat-filters{ display:flex; gap:.4rem; flex-wrap:wrap; }
.cat-filter-btn{
  padding:.4rem .8rem; border:2px solid #d0d0d0; background:#fafafa;
  font-size:.6rem; letter-spacing:.14em; text-transform:uppercase; font-weight:600;
  color:#666; transition:all var(--ease); cursor:pointer;
}
.cat-filter-btn:hover,
.cat-filter-btn.active{ border-color:var(--black); color:var(--black); background:#f0f0f0; }

.product-grid{
  display:grid; grid-template-columns:repeat(2, 1fr); gap:.8rem;
}
.category-section{ grid-column:1/-1; margin-top:2rem; }
.category-section:first-child{ margin-top:0; }
.category-title{
  font-family:var(--display); font-size:1.2rem; font-weight:700;
  letter-spacing:.06em; text-transform:uppercase;
  color:var(--black); margin-bottom:1rem;
  padding-bottom:.6rem; border-bottom:2px solid var(--red);
  word-wrap:break-word;
}
.product-card{
  transition:transform var(--ease); cursor:pointer;
  background:#f5f5f5; padding:.6rem; border-radius:4px;
  border:1px solid #e0e0e0;
}
.product-card:hover{ transform:translateY(-4px); box-shadow:0 4px 12px rgba(0,0,0,.08); }
.product-card-img{
  aspect-ratio:1/1; background:#e8e8e8; overflow:hidden; position:relative; margin-bottom:.6rem;
  border-radius:3px;
}
.product-card-img img{ width:100%; height:100%; object-fit:cover; }
.product-card-tag{
  position:absolute; top:.5rem; left:.5rem;
  background:var(--red); color:var(--black);
  font-size:.5rem; letter-spacing:.15em; text-transform:uppercase;
  padding:.2rem .5rem; font-weight:700;
}
.product-card-name{ font-size:.78rem; font-weight:600; margin-bottom:.2rem; color:var(--black); }
.product-card-price{ font-size:.72rem; color:var(--grey-400); }

/* ===== MODAL PRODUIT ===== */
.modal-backdrop{
  display:none; position:fixed; inset:0; background:rgba(10,10,10,.52); z-index:300;
  align-items:center; justify-content:center; padding:.5rem;
}
.modal-backdrop.active{ display:flex; }
.modal{
  background:var(--white); width:100%; max-height:92vh; overflow-y:auto;
  display:grid; grid-template-columns:1fr; position:relative;
}
.modal-close{
  position:absolute; top:.6rem; right:.6rem; z-index:5;
  width:32px; height:32px; border-radius:50%; border:none;
  background:rgba(250,250,248,.95); font-size:1rem; color:var(--black);
  display:flex; align-items:center; justify-content:center; cursor:pointer;
}
.modal-img{ background:#f5f5f5; min-height:200px; display:flex; align-items:center; justify-content:center; }
.modal-img img{ width:100%; height:100%; object-fit:contain; }
.product-carousel{ position:relative; width:100%; height:100%; overflow:hidden; }
.carousel-images{ display:flex; width:100%; height:100%; transition:transform 0.4s ease; }
.carousel-images img{ flex-shrink:0; width:100%; height:100%; object-fit:contain; }
.carousel-arrow{
  position:absolute; top:50%; transform:translateY(-50%);
  width:32px; height:32px; background:rgba(255,255,255,0.9); border:none; border-radius:50%;
  font-size:1rem; cursor:pointer; z-index:2; display:flex; align-items:center; justify-content:center;
}
.carousel-arrow-left{ left:.5rem; }
.carousel-arrow-right{ right:.5rem; }
.carousel-dots{ position:absolute; bottom:.5rem; left:50%; transform:translateX(-50%); display:flex; gap:.4rem; z-index:2; }
.carousel-dot{ width:8px; height:8px; border-radius:50%; background:rgba(255,255,255,.5); cursor:pointer; }
.carousel-dot.active{ background:var(--red); width:20px; border-radius:4px; }

.modal-body{ padding:1.2rem; }
.modal-body h3{
  font-family:var(--display); font-size:1.4rem; font-weight:700;
  letter-spacing:.04em; margin-bottom:.3rem; text-transform:uppercase;
}
.modal-price-tag{ font-size:.9rem; color:var(--grey-600); margin-bottom:.8rem; }
.modal-desc{ font-size:.78rem; color:var(--grey-600); line-height:1.7; margin-bottom:1.2rem; }

.field{ margin-bottom:.8rem; }
.field label{
  display:block; font-size:.58rem; letter-spacing:.18em; text-transform:uppercase;
  color:var(--grey-400); margin-bottom:.3rem; font-weight:600;
}
.field select, .field input, .field textarea{
  width:100%; padding:.6rem .7rem; border:2px solid #ddd; background:transparent;
  font-size:16px; color:var(--black); outline:none; font-family:var(--body);
}
.field textarea{ resize:vertical; min-height:120px; }

.size-table{ width:100%; border-collapse:collapse; margin-bottom:.5rem; font-size:.75rem; }
.size-table thead th{
  font-size:.5rem; letter-spacing:.12em; text-transform:uppercase; color:var(--grey-400);
  font-weight:600; padding:.5rem .3rem; border-bottom:2px solid #ddd; text-align:center;
}
.size-table thead th:first-child{ text-align:left; }
.size-table tbody td{ padding:.4rem .3rem; border-bottom:1px solid #eee; text-align:center; font-size:.75rem; }
.size-table tbody td:first-child{ font-weight:700; text-align:left; }
.size-table .qty-input{
  width:50px; padding:.3rem; border:2px solid #ddd; text-align:center;
  font-size:16px; font-weight:600; outline:none; font-family:var(--body);
}
.size-table .qty-input:focus{ border-color:var(--black); }

.modal-min-warn{
  background:#fff3cd; border:1px solid #ffc107; padding:.5rem .6rem;
  font-size:.65rem; color:#856404; font-weight:600; display:none;
}
.modal-min-warn.show{ display:block; }

.modal-footer{ margin-top:auto; padding-top:.8rem; }
.modal-footer-info{
  display:flex; justify-content:space-between; font-size:.75rem; color:var(--grey-600); margin-bottom:.3rem;
}
.btn-add-cart{
  margin-top:.8rem; width:100%; padding:.8rem; border:2px solid var(--black); background:transparent;
  font-size:.72rem; letter-spacing:.15em; text-transform:uppercase; font-weight:600;
  color:var(--black); transition:all var(--ease); cursor:pointer;
}
.btn-add-cart:hover:not(:disabled){ background:var(--black); color:var(--white); }
.btn-add-cart:disabled{ opacity:.35; cursor:not-allowed; }

/* Personnalisation */
.perso-btn{
  font-size:.55rem; letter-spacing:.08em; text-transform:uppercase; font-weight:600;
  color:var(--red); background:none; border:1px solid var(--red); padding:.2rem .4rem;
  cursor:pointer; border-radius:2px;
}
.perso-btn.done{ color:var(--grey-400); border-color:#ddd; }
.perso-overlay{
  display:none; position:fixed; inset:0; background:rgba(10,10,10,.52); z-index:350;
  align-items:center; justify-content:center; padding:1rem;
}
.perso-overlay.active{ display:flex; }
.perso-box{
  background:var(--white); max-width:400px; width:100%; padding:1.5rem; position:relative;
  max-height:80vh; overflow-y:auto;
}
.perso-box h4{
  font-family:var(--display); font-size:1rem; font-weight:700; margin-bottom:1rem;
  text-transform:uppercase; letter-spacing:.04em;
}
.perso-row{
  display:grid; gap:.4rem; align-items:center;
  margin-bottom:.5rem; font-size:.75rem;
}
.perso-row.perso-row-both{ grid-template-columns:auto 1fr 60px; }
.perso-row.perso-row-single{ grid-template-columns:auto 1fr; }
.perso-row input{
  padding:.35rem .5rem; border:2px solid #ddd; font-size:16px;
  outline:none; font-family:var(--body);
}
.perso-row span{ font-weight:600; color:var(--grey-400); }
.perso-save{
  margin-top:.8rem; width:100%; padding:.7rem; border:2px solid var(--black);
  background:var(--black); color:var(--white); font-size:.65rem; letter-spacing:.15em;
  text-transform:uppercase; font-weight:600; cursor:pointer;
}

/* ===== CART DRAWER ===== */
#cart-backdrop{ display:none; position:fixed; inset:0; background:rgba(10,10,10,.35); z-index:399; }
#cart-backdrop.active{ display:block; }
#cart-drawer{
  position:fixed; top:0; right:-100%; width:100%; max-width:420px; height:100vh;
  background:var(--white); border-left:1px solid #ddd;
  z-index:400; display:flex; flex-direction:column;
  transition:right var(--ease); box-shadow:-8px 0 48px rgba(0,0,0,.09);
}
#cart-drawer.open{ right:0; }
.cart-head{
  padding:1.2rem; border-bottom:1px solid #ddd;
  display:flex; justify-content:space-between; align-items:center;
}
.cart-head h3{
  font-family:var(--display); font-size:1.2rem; font-weight:700;
  letter-spacing:.08em; text-transform:uppercase;
}
.cart-close-btn{ background:none; border:none; font-size:1.2rem; color:var(--grey-600); cursor:pointer; }
.cart-items-wrap{ flex:1; overflow-y:auto; padding:1rem; }
.cart-empty-msg{ text-align:center; padding:3rem 1rem; color:var(--grey-400); font-size:.82rem; font-style:italic; }
.cart-item{ display:flex; gap:.8rem; padding:.8rem 0; border-bottom:1px solid var(--off); }
.cart-item-img{ width:50px; height:50px; background:var(--off); flex-shrink:0; overflow:hidden; }
.cart-item-img img{ width:100%; height:100%; object-fit:cover; }
.cart-item-info{ flex:1; min-width:0; }
.cart-item-name{ font-size:.78rem; font-weight:600; margin-bottom:.15rem; }
.cart-item-meta{ font-size:.65rem; color:var(--grey-400); line-height:1.5; }
.cart-item-right{ display:flex; flex-direction:column; align-items:flex-end; gap:.3rem; }
.cart-item-price{ font-size:.78rem; font-weight:600; }
.btn-remove{
  font-size:.58rem; letter-spacing:.12em; text-transform:uppercase;
  color:var(--grey-400); background:none; border:none; cursor:pointer; font-weight:600;
}
.btn-remove:hover{ color:#c00; }
.cart-foot{ padding:1.2rem; border-top:1px solid #ddd; }
.cart-total-row{ display:flex; justify-content:space-between; font-weight:600; margin-bottom:.8rem; }
.cart-min-warn{
  display:none; font-size:.7rem; color:#c00; padding:.5rem .6rem;
  background:var(--red-bg); border:1px solid #f0c8c4; margin-bottom:.7rem; line-height:1.5;
}
.cart-min-warn.show{ display:block; }
.btn-validate{
  width:100%; padding:.8rem; background:var(--black); color:var(--white); border:none;
  font-size:.65rem; letter-spacing:.2em; text-transform:uppercase; font-weight:600;
  cursor:pointer; transition:background var(--ease);
}
.btn-validate:hover{ background:#2a2a2a; }
.btn-validate:disabled{ background:#ccc; color:#888; }

/* ===== COMMANDES ===== */
.dash-header{ margin-bottom:1.5rem; }
.dash-header h2{
  font-family:var(--display); font-size:1.8rem; font-weight:700;
  letter-spacing:.04em; margin-bottom:.3rem; text-transform:uppercase;
}
.dash-header p{ font-size:.78rem; color:var(--grey-600); }
.orders-table{ width:100%; border-collapse:collapse; font-size:.72rem; }
.orders-table th{
  text-align:left; font-size:.55rem; letter-spacing:.18em; text-transform:uppercase;
  color:var(--grey-400); font-weight:600; padding:.6rem 0; border-bottom:1px solid #ddd;
}
.orders-table td{
  padding:.8rem .3rem .8rem 0; border-bottom:1px solid #eee; font-size:.72rem; color:var(--grey-600);
}
.orders-table td:first-child{ color:var(--black); font-weight:600; font-family:var(--display); font-size:.85rem; }
.badge{
  display:inline-block; padding:.2rem .5rem;
  font-size:.5rem; letter-spacing:.1em; text-transform:uppercase; border:1px solid; font-weight:600;
}
.badge-pending{ color:var(--amber); border-color:#e8d7a8; background:#faf7ee; }
.badge-production{ color:var(--blue); border-color:#b0d2ee; background:#eff6fb; }
.badge-shipped{ color:var(--green); border-color:#a8ddc8; background:#eff9f4; }
.badge-delivered{ color:var(--grey-600); border-color:#ddd; background:var(--off); }

/* ===== DEMANDES ===== */
.demande-form{ max-width:600px; margin-bottom:2.5rem; }
.demande-form .field input,
.demande-form .field textarea{ font-size:16px; }
.btn-send-demande{
  padding:.8rem 2rem; background:var(--black); color:var(--white); border:none;
  font-size:.65rem; letter-spacing:.18em; text-transform:uppercase; font-weight:600;
  cursor:pointer; transition:background var(--ease);
}
.btn-send-demande:hover{ background:#2a2a2a; }
.btn-send-demande:disabled{ background:#ccc; color:#888; }

.demandes-list{ margin-top:2rem; }
.demande-card{
  border:1px solid #e0e0e0; border-radius:6px; padding:1rem; margin-bottom:1rem;
  background:#fafafa;
}
.demande-card-header{
  display:flex; justify-content:space-between; align-items:center;
  margin-bottom:.6rem; flex-wrap:wrap; gap:.3rem;
}
.demande-card-objet{
  font-family:var(--display); font-size:1rem; font-weight:700;
  text-transform:uppercase; letter-spacing:.04em;
}
.demande-card-date{ font-size:.65rem; color:var(--grey-400); }
.demande-card-statut{
  display:inline-block; padding:.15rem .5rem; border-radius:3px;
  font-size:.5rem; letter-spacing:.1em; text-transform:uppercase; font-weight:700;
}
.statut-nouvelle{ background:#fff3cd; color:#856404; }
.statut-encours{ background:#d1ecf1; color:#0c5460; }
.statut-traitee{ background:#d4edda; color:#155724; }
.demande-card-message{
  font-size:.8rem; color:var(--grey-600); line-height:1.6;
  margin-bottom:.5rem; white-space:pre-wrap;
}
.demande-card-reponse{
  background:#e8f5e9; border-left:3px solid var(--green); padding:.8rem;
  margin-top:.6rem; border-radius:0 4px 4px 0;
}
.demande-card-reponse-label{
  font-size:.55rem; letter-spacing:.15em; text-transform:uppercase;
  color:var(--green); font-weight:700; margin-bottom:.3rem;
}
.demande-card-reponse-text{
  font-size:.8rem; color:var(--black); line-height:1.6; white-space:pre-wrap;
}

/* ===== CONFIRMATION ===== */
#order-confirmation{ position:fixed; inset:0; z-index:999; display:none; }
#order-confirmation.active{ display:flex; align-items:center; justify-content:center; }
.confirmation-overlay{ position:absolute; inset:0; background:rgba(0,0,0,.8); backdrop-filter:blur(4px); }
.confirmation-modal{
  position:relative; background:var(--white); width:95%; max-width:600px;
  max-height:90vh; overflow-y:auto; border-radius:8px;
}
.confirmation-close{
  position:absolute; top:.8rem; right:.8rem; width:32px; height:32px;
  border:none; background:var(--white); font-size:1.2rem; cursor:pointer; border-radius:50%; z-index:1;
}
.confirmation-header{ text-align:center; padding:1.5rem 1rem; border-bottom:1px solid #ddd; }
.confirmation-icon{
  width:60px; height:60px; margin:0 auto 1rem;
  background:var(--red); color:var(--black); border-radius:50%;
  display:flex; align-items:center; justify-content:center; font-size:2rem; font-weight:700;
}
.confirmation-header h2{ font-family:var(--display); font-size:1.5rem; font-weight:700; text-transform:uppercase; margin-bottom:.3rem; }
.confirmation-header p{ color:var(--grey-400); font-size:.85rem; }
.confirmation-body{ padding:1.2rem; display:grid; grid-template-columns:1fr; gap:1.2rem; }
.confirmation-section{ margin-bottom:1rem; }
.confirmation-section h3{
  font-family:var(--display); font-size:1rem; font-weight:700;
  margin-bottom:.8rem; text-transform:uppercase; letter-spacing:.04em;
}
#confirmation-recap{ background:#f5f5f5; padding:.8rem; border-radius:4px; font-size:.82rem; line-height:1.7; }
.rib-section{ background:#fffbeb; padding:1rem; border-radius:8px; border:2px solid var(--red); }
.rib-instruction{ font-size:.82rem; margin-bottom:1rem; line-height:1.5; }
.rib-info{ background:var(--white); padding:1rem; border-radius:4px; margin-bottom:.8rem; }
.rib-row{ display:flex; justify-content:space-between; align-items:center; padding:.5rem 0; border-bottom:1px solid #eee; flex-wrap:wrap; gap:.3rem; }
.rib-row:last-child{ border-bottom:none; }
.rib-label{ font-weight:600; color:var(--grey-600); font-size:.7rem; text-transform:uppercase; letter-spacing:.08em; }
.rib-value{ font-family:monospace; font-size:.75rem; color:var(--black); font-weight:600; word-break:break-all; }
.rib-copyable{ cursor:pointer; padding:.3rem .5rem; background:#f5f5f5; border-radius:4px; }
.rib-copyable:hover{ background:var(--red); color:var(--black); }
.copy-icon{ margin-left:.3rem; font-size:.75rem; opacity:.6; }
.rib-reference{ background:var(--red); color:var(--black); font-weight:700; }
.rib-note{ text-align:center; font-size:.75rem; color:var(--grey-400); font-style:italic; }
.confirmation-footer{ padding:1rem; border-top:1px solid #ddd; text-align:center; }
.btn-confirmation-close{
  padding:.8rem 2rem; background:var(--black); color:var(--white); border:2px solid var(--black);
  font-size:.65rem; letter-spacing:.15em; text-transform:uppercase; font-weight:600; cursor:pointer;
}

/* ===== TOAST ===== */
#toast{
  position:fixed; bottom:1.5rem; left:50%; transform:translateX(-50%) translateY(200%);
  background:var(--black); color:var(--white);
  padding:0; font-size:.75rem; letter-spacing:.05em;
  z-index:500; transition:transform .45s cubic-bezier(.4,0,.2,1), padding .1s, opacity .3s;
  pointer-events:none; max-width:90vw; text-align:center;
  box-shadow:0 8px 32px rgba(0,0,0,.22);
  visibility:hidden; opacity:0;
}
#toast.show{ transform:translateX(-50%) translateY(0); visibility:visible; opacity:1; padding:.8rem 1.5rem; }

.spinner{
  width:32px; height:32px; border:2px solid #ddd; border-top-color:var(--black);
  border-radius:50%; animation:spin .6s linear infinite; margin:3rem auto;
}
@keyframes spin{ to{transform:rotate(360deg)} }

/* ===== DESKTOP ===== */
@media(min-width:769px){
  .v-nav{ padding:1rem 2.8rem; }
  .v-nav-logo img{ height:60px; }
  .v-club-logo{ height:55px; max-width:120px; }
  .v-nav-club-wrapper{ gap:1.2rem; padding-left:1.5rem; }
  .v-nav-club{ font-size:.8rem; letter-spacing:.2em; }
  .v-nav-right{ gap:1.2rem; }
  .v-tab{ font-size:.68rem; letter-spacing:.2em; padding:.5rem 0; }
  .v-btn-cart{ font-size:.65rem; padding:.5rem 1rem; }
  .v-btn-quit{ font-size:.62rem; padding:.4rem .8rem; }
  .v-section{ padding:3rem 2.8rem; }
  .cat-header{ flex-direction:row; align-items:flex-end; }
  .cat-header h2{ font-size:2.2rem; }
  .product-grid{ grid-template-columns:repeat(auto-fill,minmax(270px,1fr)); gap:2rem; }
  .category-title{ font-size:1.5rem; }
  .product-card{ padding:1rem; }
  .product-card-name{ font-size:.9rem; }
  .product-card-price{ font-size:.84rem; }
  .modal{ grid-template-columns:1fr 1fr; max-width:800px; }
  .modal-img{ min-height:400px; }
  .modal-body{ padding:2.5rem; }
  .modal-body h3{ font-size:2rem; }
  .confirmation-body{ grid-template-columns:1fr 1fr; }
  #cart-drawer{ right:-460px; width:420px; }
}
</style>
</head>
<body>

<!-- ===== LOGIN ===== -->
<div id="login-screen">
  <div class="login-box">
    <div class="login-box-logo">
      <img src="https://i.imgur.com/e68bB0X.png" alt="BOTH">
    </div>
    <h2>Le Vestiaire</h2>
    <p>Entrez l'email associ√© √† votre club pour acc√©der √† votre espace.</p>
    <input type="email" class="login-input" id="login-email" placeholder="votre@club.com" onkeydown="if(event.key==='Enter')loginClub()">
    <div class="login-error" id="login-error"></div>
    <button class="btn-login" id="btn-login" onclick="loginClub()">Acc√©der au Vestiaire</button>
    <a href="/" class="login-back">‚Üê Retour au studio</a>
  </div>
</div>

<!-- ===== PORTAL ===== -->
<div id="portal">
  <div class="v-nav">
    <div class="v-nav-left">
      <div class="v-nav-logo"><img src="https://i.imgur.com/e68bB0X.png" alt="BOTH"></div>
      <div class="v-nav-club-wrapper">
        <img id="v-club-logo" class="v-club-logo" src="" alt="" style="display:none;">
        <div class="v-nav-club" id="v-club-name">‚Äî</div>
      </div>
    </div>
    <div class="v-nav-right">
      <button class="v-tab active" data-tab="catalogue" onclick="switchTab('catalogue')">Catalogue</button>
      <button class="v-tab" data-tab="commandes" onclick="switchTab('commandes')">Commandes</button>
      <button class="v-tab" data-tab="demandes" onclick="switchTab('demandes')">Demandes</button>
      <button class="v-btn-cart" onclick="toggleCart()">Panier <div class="cart-badge" id="cart-badge">0</div></button>
      <button class="v-btn-quit" onclick="closePortal()">Quitter</button>
    </div>
  </div>

  <div class="v-section active" id="section-catalogue">
    <div class="v-section-inner">
      <div class="cat-header">
        <h2>Catalogue</h2>
        <div class="cat-filters" id="cat-filters">
          <button class="cat-filter-btn active" onclick="filterProducts(this,'tous')">Tous</button>
        </div>
      </div>
      <div class="product-grid" id="product-grid"><div class="spinner"></div></div>
    </div>
  </div>

  <div class="v-section" id="section-commandes">
    <div class="v-section-inner">
      <div class="dash-header">
        <h2>Mes Commandes</h2>
        <p>Suivi en temps r√©el de vos commandes pass√©es.</p>
      </div>
      <div id="orders-wrap"><div class="spinner"></div></div>
    </div>
  </div>

  <div class="v-section" id="section-demandes">
    <div class="v-section-inner">
      <div class="dash-header">
        <h2>Demandes</h2>
        <p>Envoyez-nous vos demandes : devis, nouveau produit, question...</p>
      </div>
      <div class="demande-form">
        <div class="field">
          <label>Objet</label>
          <input type="text" id="demande-objet" placeholder="Ex: Demande de devis hoodie">
        </div>
        <div class="field">
          <label>Message</label>
          <textarea id="demande-message" placeholder="D√©crivez votre demande..."></textarea>
        </div>
        <button class="btn-send-demande" id="btn-send-demande" onclick="sendDemande()">Envoyer la demande</button>
      </div>
      <div class="demandes-list" id="demandes-list"><div class="spinner"></div></div>
    </div>
  </div>
</div>

<!-- ===== PRODUCT MODAL ===== -->
<div class="modal-backdrop" id="modal-backdrop" onclick="modalClickOut(event)">
  <div class="modal" id="product-modal">
    <button class="modal-close" onclick="closeModal()">‚úï</button>
    <div class="modal-img" id="modal-img"></div>
    <div class="modal-body">
      <h3 id="modal-name"></h3>
      <div class="modal-desc" id="modal-desc"></div>
      <div id="modal-table-wrap"></div>
      <div class="modal-footer">
        <div class="modal-footer-info">
          <span>Articles : <strong id="modal-total-qty">0</strong></span>
          <span>Total : <strong id="modal-total-price">0,00 ‚Ç¨</strong></span>
        </div>
        <button class="btn-add-cart" id="btn-add-cart" onclick="addToCart()" disabled>Ajouter au panier</button>
      </div>
    </div>
  </div>
</div>

<!-- ===== CART DRAWER ===== -->
<div id="cart-backdrop" onclick="toggleCart()"></div>
<div id="cart-drawer">
  <div class="cart-head"><h3>Panier</h3><button class="cart-close-btn" onclick="toggleCart()">‚úï</button></div>
  <div class="cart-items-wrap" id="cart-items-wrap"><div class="cart-empty-msg">Votre panier est vide.</div></div>
  <div class="cart-foot">
    <div class="cart-total-row"><span>Total</span><span id="cart-total">0,00 ‚Ç¨</span></div>
    <div class="cart-min-warn" id="cart-min-warn">‚ö† Minimum non atteint. Il manque <strong id="min-rest">0,00 ‚Ç¨</strong>.</div>
    <button class="btn-validate" id="btn-validate" onclick="validateOrder()">Valider la commande</button>
  </div>
</div>

<!-- ===== TOAST ===== -->
<div id="toast"></div>

<!-- ===== CONFIRMATION ===== -->
<div id="order-confirmation">
  <div class="confirmation-overlay" onclick="closeConfirmation()"></div>
  <div class="confirmation-modal">
    <button class="confirmation-close" onclick="closeConfirmation()">‚úï</button>
    <div class="confirmation-header">
      <div class="confirmation-icon">‚úì</div>
      <h2>Commande valid√©e !</h2>
      <p>Votre commande a √©t√© enregistr√©e avec succ√®s.</p>
    </div>
    <div class="confirmation-body">
      <div class="confirmation-section">
        <h3>R√©capitulatif</h3>
        <div id="confirmation-recap"></div>
      </div>
      <div class="confirmation-section rib-section">
        <h3>Coordonn√©es bancaires</h3>
        <p class="rib-instruction">Effectuez votre virement avec la r√©f√©rence de commande :</p>
        <div class="rib-info">
          <div class="rib-row"><span class="rib-label">B√©n√©ficiaire</span><span class="rib-value">BOTH EQUIPMNT</span></div>
          <div class="rib-row"><span class="rib-label">IBAN</span><span class="rib-value rib-copyable" id="rib-iban" onclick="copyToClipboard('rib-iban')">FR76 1451 8292 6705 3640 9504 091<span class="copy-icon">üìã</span></span></div>
          <div class="rib-row"><span class="rib-label">BIC</span><span class="rib-value rib-copyable" id="rib-bic" onclick="copyToClipboard('rib-bic')">FTNOFRP1XXX<span class="copy-icon">üìã</span></span></div>
          <div class="rib-row"><span class="rib-label">R√©f√©rence</span><span class="rib-value rib-copyable rib-reference" id="order-reference" onclick="copyToClipboard('order-reference')"><span class="copy-icon">üìã</span></span></div>
        </div>
        <div class="rib-note">Cliquez sur les valeurs pour les copier</div>
      </div>
    </div>
    <div class="confirmation-footer"><button class="btn-confirmation-close" onclick="closeConfirmation()">Fermer</button></div>
  </div>
</div>

<script>
const API = "/.netlify/functions/airtable-api";
const S = { club:null, products:[], cart:[], orders:[], demandes:[], currentProduct:null, qty:1, persoData:{}, carouselIndex:0, carouselTotal:0 };

function toast(msg, dur=2800){ const el=document.getElementById('toast'); el.textContent=msg; el.classList.add('show'); setTimeout(()=>el.classList.remove('show'),dur); }
function fmt(n){ return n.toFixed(2).replace('.',',')+' ‚Ç¨'; }

async function apiGet(action, params={}){
  const url=API+'?'+new URLSearchParams({action,...params});
  const res=await fetch(url); if(!res.ok) throw new Error('Erreur '+res.status);
  return await res.json();
}
async function apiPost(action, body={}){
  const res=await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action,...body})});
  if(!res.ok) throw new Error('Erreur '+res.status);
  return await res.json();
}

// AUTH
async function loginClub(){
  const email=document.getElementById('login-email').value.trim().toLowerCase();
  const errEl=document.getElementById('login-error');
  const btn=document.getElementById('btn-login');
  errEl.textContent='';
  if(!email){errEl.textContent='Veuillez entrer un email.';return;}
  btn.disabled=true; btn.textContent='V√©rification...';
  try{
    const res=await apiGet('getClub',{email});
    if(!res.club){errEl.textContent='Aucun club trouv√© avec cet email.';btn.disabled=false;btn.textContent='Acc√©der au Vestiaire';return;}
    S.club=res.club; btn.disabled=false; btn.textContent='Acc√©der au Vestiaire';
    document.getElementById('login-screen').style.display='none';
    openPortal();
  }catch(e){console.error(e);errEl.textContent='Erreur de connexion. R√©essayez.';btn.disabled=false;btn.textContent='Acc√©der au Vestiaire';}
}

// PORTAL
async function openPortal(){
  document.getElementById('portal').classList.add('active');
  document.getElementById('v-club-name').textContent=S.club.nom;
  const logoEl=document.getElementById('v-club-logo');
  if(S.club.logoClub&&S.club.logoClub.trim()){logoEl.src=S.club.logoClub;logoEl.alt=S.club.nom;logoEl.style.display='block';}
  else{logoEl.style.display='none';}
  await loadCatalogue();
}

function closePortal(){
  document.getElementById('portal').classList.remove('active');
  document.getElementById('login-screen').style.display='';
  S.club=null; S.cart=[]; updateCartUI();
}

// CATALOGUE
async function loadCatalogue(){
  const grid=document.getElementById('product-grid');
  grid.innerHTML='<div class="spinner"></div>';
  try{
    const res=await apiGet('getCatalogue',{clubId:S.club.id,clubNom:S.club.nom});
    S.products=res.products||[];
    const cats=[...new Set(S.products.map(p=>p.categorie).filter(Boolean))];
    const filtersEl=document.getElementById('cat-filters');
    filtersEl.innerHTML='<button class="cat-filter-btn active" onclick="filterProducts(this,\'tous\')">Tous</button>'+cats.map(c=>`<button class="cat-filter-btn" onclick="filterProducts(this,'${c}')">${c}</button>`).join('');
    renderProducts(S.products);
  }catch(e){console.error(e);grid.innerHTML='<p style="color:red;padding:2rem;">Erreur de chargement.</p>';}
}

function renderProducts(list){
  const grid=document.getElementById('product-grid');
  if(!list.length){grid.innerHTML='<p style="color:var(--grey-400);padding:2rem;font-style:italic;">Aucun produit.</p>';return;}
  const grouped={};
  list.forEach(p=>{const cat=p.categorie||'Sans cat√©gorie';if(!grouped[cat])grouped[cat]=[];grouped[cat].push(p);});
  let html='';
  Object.keys(grouped).forEach(cat=>{
    html+=`<div class="category-section"><h3 class="category-title">${cat}</h3></div>`;
    grouped[cat].forEach(p=>{
      const minTag=p.minQuantite>1?`<div class="product-card-tag">Min. ${p.minQuantite} pcs</div>`:'';
      const imgSrc=Array.isArray(p.image)?p.image[0]:p.image?p.image.split(',')[0].trim():'';
      html+=`<div class="product-card" onclick="openModal('${p.id}')">
        <div class="product-card-img">${imgSrc?`<img src="${imgSrc}" alt="${p.nom}" loading="lazy">`:''}${minTag}</div>
        <div class="product-card-name">${p.nom}</div>
        <div class="product-card-price">${fmt(p.prix)}</div>
      </div>`;
    });
  });
  grid.innerHTML=html;
}

function filterProducts(btn,cat){
  document.querySelectorAll('.cat-filter-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  renderProducts(cat==='tous'?S.products:S.products.filter(p=>p.categorie===cat));
}

// ============================================================
// MODAL ‚Äî avec personnalisation granulaire
// ============================================================
function hasPerso(p){ return p.personnalisation && p.personnalisation !== 'Aucune'; }
function persoHasNom(p){ return p.personnalisation === 'Nom' || p.personnalisation === 'Nom + Num√©ro'; }
function persoHasNum(p){ return p.personnalisation === 'Num√©ro' || p.personnalisation === 'Nom + Num√©ro'; }

function openModal(id){
  const p=S.products.find(x=>x.id===id); if(!p)return;
  S.currentProduct=p; S.persoData={};
  const modalImg=document.getElementById('modal-img');
  if(p.image){
    const images=Array.isArray(p.image)?p.image:p.image.split(',').map(u=>u.trim()).filter(u=>u);
    if(images.length===1){modalImg.innerHTML=`<img src="${images[0]}" alt="${p.nom}">`;}
    else{
      modalImg.innerHTML=`<div class="product-carousel"><div class="carousel-images" id="carousel-images">${images.map(u=>`<img src="${u}" alt="${p.nom}">`).join('')}</div><button class="carousel-arrow carousel-arrow-left" onclick="changeCarouselImage(-1)">‚Äπ</button><button class="carousel-arrow carousel-arrow-right" onclick="changeCarouselImage(1)">‚Ä∫</button><div class="carousel-dots" id="carousel-dots">${images.map((_,i)=>`<div class="carousel-dot ${i===0?'active':''}" onclick="goToCarouselImage(${i})"></div>`).join('')}</div></div>`;
      S.carouselIndex=0; S.carouselTotal=images.length;
    }
  }else{modalImg.innerHTML='<div style="width:100%;height:100%;background:var(--off);"></div>';}
  document.getElementById('modal-name').textContent=p.nom;
  document.getElementById('modal-desc').textContent=p.description||'√âquipement sportif ‚Äî Studio Both.';
  const tailles=Array.isArray(p.tailles)?p.tailles:(p.tailles?p.tailles.split(',').map(t=>t.trim()):['S','M','L','XL']);
  const minQty=p.minQuantite||1;
  const showPerso = hasPerso(p);
  let t=`<table class="size-table"><thead><tr><th>Taille</th><th>Prix</th>${showPerso?'<th>Perso</th>':''}<th>Qt√©</th></tr></thead><tbody>`;
  tailles.forEach(s=>{t+=`<tr><td>${s}</td><td>${fmt(p.prix)}</td>${showPerso?`<td><button class="perso-btn" id="perso-btn-${s}" onclick="openPerso('${s}')" style="display:none">Perso</button></td>`:''}<td><input type="number" class="qty-input" id="qty-${s}" min="0" value="0" onchange="onQtyChange()" oninput="onQtyChange()"></td></tr>`;});
  t+='</tbody></table>';
  if(minQty>1)t+=`<div class="modal-min-warn show">‚ö†Ô∏è Minimum : ${minQty} pi√®ces</div>`;
  document.getElementById('modal-table-wrap').innerHTML=t;
  document.getElementById('modal-total-qty').textContent='0';
  document.getElementById('modal-total-price').textContent=fmt(0);
  document.getElementById('btn-add-cart').disabled=true;
  document.getElementById('modal-backdrop').classList.add('active');
}

function onQtyChange(){
  const p=S.currentProduct;
  const tailles=Array.isArray(p.tailles)?p.tailles:(p.tailles?p.tailles.split(',').map(t=>t.trim()):['S','M','L','XL']);
  let totalQty=0;
  const showPerso = hasPerso(p);
  tailles.forEach(t=>{const input=document.getElementById('qty-'+t);const qty=parseInt(input.value)||0;totalQty+=qty;
    if(showPerso){const btn=document.getElementById('perso-btn-'+t);if(qty>0){btn.style.display='inline-block';if(S.persoData[t]&&S.persoData[t].length===qty){btn.textContent='‚úì Modif.';btn.classList.add('done');}else{btn.textContent='Perso';btn.classList.remove('done');if(S.persoData[t]&&S.persoData[t].length!==qty)delete S.persoData[t];}}else{btn.style.display='none';delete S.persoData[t];}}
  });
  document.getElementById('modal-total-qty').textContent=totalQty;
  document.getElementById('modal-total-price').textContent=fmt(totalQty*p.prix);
  document.getElementById('btn-add-cart').disabled=totalQty<(p.minQuantite||1);
}

function changeCarouselImage(d){if(!S.carouselTotal||S.carouselTotal<=1)return;S.carouselIndex=(S.carouselIndex+d+S.carouselTotal)%S.carouselTotal;updateCarousel();}
function goToCarouselImage(i){S.carouselIndex=i;updateCarousel();}
function updateCarousel(){const c=document.getElementById('carousel-images');const dots=document.querySelectorAll('.carousel-dot');if(!c)return;c.style.transform=`translateX(-${S.carouselIndex*100}%)`;dots.forEach((d,i)=>d.classList.toggle('active',i===S.carouselIndex));}

// ============================================================
// PERSONNALISATION GRANULAIRE
// ============================================================
function openPerso(taille){
  const p=S.currentProduct;const qty=parseInt(document.getElementById('qty-'+taille).value)||0;if(!qty)return;
  const existing=S.persoData[taille]||[];
  const showNom = persoHasNom(p);
  const showNum = persoHasNum(p);
  const rowClass = (showNom && showNum) ? 'perso-row-both' : 'perso-row-single';

  let html=`<div class="perso-overlay active" id="perso-overlay" onclick="if(event.target===this)closePerso()"><div class="perso-box"><button onclick="closePerso()" style="position:absolute;top:.6rem;right:.6rem;width:28px;height:28px;border:none;background:#eee;border-radius:50%;font-size:.9rem;cursor:pointer;display:flex;align-items:center;justify-content:center;">‚úï</button><h4>${p.nom} ‚Äî ${taille}</h4><p style="font-size:.7rem;color:var(--grey-400);margin-bottom:.8rem;">${qty} pi√®ce${qty>1?'s':''} ‚Äî ${p.personnalisation}</p>`;
  for(let i=0;i<qty;i++){
    const nom=existing[i]?existing[i].nom:'';
    const num=existing[i]?existing[i].num:'';
    html+=`<div class="perso-row ${rowClass}"><span>#${i+1}</span>`;
    if(showNom) html+=`<input type="text" placeholder="Nom" maxlength="16" id="perso-nom-${taille}-${i}" value="${nom}">`;
    if(showNum) html+=`<input type="text" placeholder="N¬∞" maxlength="3" id="perso-num-${taille}-${i}" value="${num}">`;
    html+=`</div>`;
  }
  html+=`<button class="perso-save" onclick="savePerso('${taille}',${qty})">Valider</button></div></div>`;
  document.body.insertAdjacentHTML('beforeend',html);
}

function savePerso(taille,qty){
  const p=S.currentProduct;
  const showNom = persoHasNom(p);
  const showNum = persoHasNum(p);
  S.persoData[taille]=[];
  for(let i=0;i<qty;i++){
    S.persoData[taille].push({
      nom: showNom ? document.getElementById('perso-nom-'+taille+'-'+i).value.trim() : '',
      num: showNum ? document.getElementById('perso-num-'+taille+'-'+i).value.trim() : ''
    });
  }
  closePerso();onQtyChange();
}
function closePerso(){const o=document.getElementById('perso-overlay');if(o)o.remove();}
function closeModal(){document.getElementById('modal-backdrop').classList.remove('active');}
function modalClickOut(e){if(e.target===document.getElementById('modal-backdrop'))closeModal();}

function addToCart(){
  const p=S.currentProduct;
  const tailles=Array.isArray(p.tailles)?p.tailles:(p.tailles?p.tailles.split(',').map(t=>t.trim()):['S','M','L','XL']);
  tailles.forEach(t=>{const qty=parseInt(document.getElementById('qty-'+t).value)||0;if(!qty)return;
    if(hasPerso(p)&&S.persoData[t]){S.persoData[t].forEach(perso=>{S.cart.push({productId:p.id,nom:p.nom,image:p.image,prix:p.prix,taille:t,nomPerso:perso.nom,numPerso:perso.num,quantite:1});});}
    else{S.cart.push({productId:p.id,nom:p.nom,image:p.image,prix:p.prix,taille:t,nomPerso:'',numPerso:'',quantite:qty});}
  });
  updateCartUI();closeModal();
  const total=tailles.reduce((s,t)=>s+(parseInt(document.getElementById('qty-'+t).value)||0),0);
  toast(`${p.nom} ‚Äî ${total} article${total>1?'s':''} ajout√©${total>1?'s':''} ‚úì`);
}

function removeFromCart(i){S.cart.splice(i,1);updateCartUI();}

function updateCartUI(){
  const wrap=document.getElementById('cart-items-wrap');
  const totalArticles=S.cart.reduce((s,i)=>s+i.quantite,0);
  const totalPrix=S.cart.reduce((s,i)=>s+(i.prix*i.quantite),0);
  const badge=document.getElementById('cart-badge');
  badge.textContent=totalArticles;badge.classList.toggle('show',totalArticles>0);
  document.getElementById('cart-total').textContent=fmt(totalPrix);
  if(!S.cart.length){wrap.innerHTML='<div class="cart-empty-msg">Votre panier est vide.</div>';}
  else{wrap.innerHTML=S.cart.map((item,i)=>`<div class="cart-item"><div class="cart-item-img">${item.image?`<img src="${Array.isArray(item.image)?item.image[0]:item.image.split(',')[0].trim()}" alt="${item.nom}">`:'<div style="width:100%;height:100%;background:var(--off);"></div>'}</div><div class="cart-item-info"><div class="cart-item-name">${item.nom}</div><div class="cart-item-meta">Taille: ${item.taille}${item.nomPerso?' ¬∑ '+item.nomPerso:''}${item.numPerso?' ¬∑ #'+item.numPerso:''} ¬∑ Qt√©: ${item.quantite}</div></div><div class="cart-item-right"><div class="cart-item-price">${fmt(item.prix*item.quantite)}</div><button class="btn-remove" onclick="removeFromCart(${i})">Supprimer</button></div></div>`).join('');}
  const warnEl=document.getElementById('cart-min-warn');const btnVal=document.getElementById('btn-validate');
  if(S.club&&S.club.activeMin){const min=parseFloat(S.club.minCommande)||0;if(totalPrix<min){warnEl.classList.add('show');document.getElementById('min-rest').textContent=fmt(min-totalPrix);btnVal.disabled=true;}else{warnEl.classList.remove('show');btnVal.disabled=(totalArticles===0);}}
  else{warnEl.classList.remove('show');btnVal.disabled=(totalArticles===0);}
}

function toggleCart(){document.getElementById('cart-drawer').classList.toggle('open');document.getElementById('cart-backdrop').classList.toggle('active');}

async function validateOrder(){
  if(!S.cart.length)return;
  const btn=document.getElementById('btn-validate');btn.disabled=true;btn.textContent='Envoi...';
  try{
    const res=await apiPost('createOrder',{clubId:S.club.id,clubNom:S.club.nom,lignes:S.cart.map(i=>({productId:i.productId,nom:i.nom,prix:i.prix,taille:i.taille,nomPerso:i.nomPerso||'',numPerso:i.numPerso||'',quantite:i.quantite})),total:S.cart.reduce((s,i)=>s+(i.prix*i.quantite),0)});
    if(res.success){const ref=res.orderRef||'CMD-'+Date.now();const total=S.cart.reduce((s,i)=>s+(i.prix*i.quantite),0);showOrderConfirmation(ref,S.cart,total);S.cart=[];updateCartUI();toggleCart();if(document.getElementById('section-commandes').classList.contains('active'))loadOrders();}
    else{toast('Erreur. R√©essayez.');}
  }catch(e){console.error(e);toast('Erreur r√©seau.');}
  btn.disabled=false;btn.textContent='Valider la commande';
}

function showOrderConfirmation(ref,cart,total){
  document.getElementById('order-confirmation').classList.add('active');
  document.getElementById('order-reference').textContent=ref;
  document.getElementById('confirmation-recap').innerHTML=`<p><strong>R√©f:</strong> ${ref}</p><p><strong>Club:</strong> ${S.club.nom}</p><p><strong>Articles:</strong> ${cart.reduce((s,i)=>s+i.quantite,0)}</p><p><strong>Total:</strong> ${fmt(total)}</p><br>${cart.map(i=>`<p style="font-size:.8rem;margin-top:.3rem;">‚Ä¢ ${i.nom} (${i.taille}) ${i.nomPerso?'- '+i.nomPerso:''} ${i.numPerso?'#'+i.numPerso:''} √ó${i.quantite}</p>`).join('')}`;
}
function closeConfirmation(){document.getElementById('order-confirmation').classList.remove('active');}
function copyToClipboard(id){const el=document.getElementById(id);const text=el.textContent.trim().replace('üìã','').trim();navigator.clipboard.writeText(text).then(()=>toast('‚úì Copi√©')).catch(()=>toast('Erreur de copie'));}

// ============================================================
// COMMANDES
// ============================================================
async function loadOrders(){
  const wrap=document.getElementById('orders-wrap');wrap.innerHTML='<div class="spinner"></div>';
  try{
    const res=await apiGet('getOrders',{clubId:S.club.id});S.orders=res.orders||[];
    if(!S.orders.length){wrap.innerHTML='<p style="color:var(--grey-400);padding:2rem;font-style:italic;">Aucune commande.</p>';return;}
    const bc=s=>{if(s.includes('ATTENTE'))return'badge-pending';if(s.includes('PRODUCTION'))return'badge-production';if(s.includes('LIVR√âE')||s.includes('LIVREE'))return'badge-delivered';return'badge-pending';};
    wrap.innerHTML=`<table class="orders-table"><thead><tr><th>R√©f.</th><th>Date</th><th>Articles</th><th>Total</th><th>Statut</th></tr></thead><tbody>${S.orders.map(o=>`<tr><td>${o.ref||'‚Äî'}</td><td>${o.date||'‚Äî'}</td><td>${o.nbArticles||'‚Äî'}</td><td>${fmt(parseFloat(o.total)||0)}</td><td><span class="badge ${bc(o.statut)}">${o.statut||'‚Äî'}</span></td></tr>`).join('')}</tbody></table>`;
  }catch(e){console.error(e);wrap.innerHTML='<p style="color:red;padding:2rem;">Erreur.</p>';}
}

// ============================================================
// DEMANDES
// ============================================================
async function loadDemandes(){
  const wrap=document.getElementById('demandes-list');wrap.innerHTML='<div class="spinner"></div>';
  try{
    const res=await apiGet('getDemandes',{clubId:S.club.id});
    S.demandes=res.demandes||[];
    if(!S.demandes.length){wrap.innerHTML='<p style="color:var(--grey-400);padding:1rem 0;font-style:italic;">Aucune demande pour le moment.</p>';return;}
    wrap.innerHTML=S.demandes.map(d=>{
      const statutClass = d.statut.includes('cours') ? 'statut-encours' : d.statut.includes('rait') ? 'statut-traitee' : 'statut-nouvelle';
      return `<div class="demande-card">
        <div class="demande-card-header">
          <span class="demande-card-objet">${d.objet||'Sans objet'}</span>
          <span class="demande-card-date">${d.date}</span>
        </div>
        <span class="demande-card-statut ${statutClass}">${d.statut}</span>
        <div class="demande-card-message">${d.message}</div>
        ${d.reponse ? `<div class="demande-card-reponse"><div class="demande-card-reponse-label">R√©ponse de Both Equipmnt</div><div class="demande-card-reponse-text">${d.reponse}</div></div>` : ''}
      </div>`;
    }).join('');
  }catch(e){console.error(e);wrap.innerHTML='<p style="color:red;padding:1rem;">Erreur de chargement.</p>';}
}

async function sendDemande(){
  const objet=document.getElementById('demande-objet').value.trim();
  const message=document.getElementById('demande-message').value.trim();
  if(!objet||!message){toast('Remplissez l\'objet et le message.');return;}
  const btn=document.getElementById('btn-send-demande');
  btn.disabled=true;btn.textContent='Envoi...';
  try{
    const res=await apiPost('createDemande',{clubId:S.club.id,objet,message});
    if(res.success){
      toast('‚úì Demande envoy√©e !');
      document.getElementById('demande-objet').value='';
      document.getElementById('demande-message').value='';
      loadDemandes();
    }else{toast('Erreur : '+(res.error||'R√©essayez.'));}
  }catch(e){console.error(e);toast('Erreur r√©seau.');}
  btn.disabled=false;btn.textContent='Envoyer la demande';
}

// ============================================================
// TAB SWITCH
// ============================================================
function switchTab(tab){
  document.querySelectorAll('.v-tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.v-section').forEach(s=>s.classList.remove('active'));
  document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
  document.getElementById(`section-${tab}`).classList.add('active');
  if(tab==='commandes')loadOrders();
  if(tab==='demandes')loadDemandes();
}
</script>
</body>
</html>
